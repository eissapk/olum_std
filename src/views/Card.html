<template>
  <div class="Card">
    ${ this.data ? `

      <div class="Card__header">
        <section class="Card__header__type">
          <img src="${this.data.type == 'bug' ? bugIcon : this.data.type == 'task' ? taskIcon : ''}" alt="${this.data.type}">
          ${this.data.type.upper()}-${this.data.id}
        </section>
        <button type="button" class="Card__header--delBtn">${icons.trash}</button>
      </div>

      <div class="Card__inner">
        <div class="Card__inner__content">
          
          <div class="Card__inner__content__title">
            <input type="text" value="${this.data.title}" />
          </div>
          
          <div class="Card__inner__content__desc">
            <p class="hint">Description</p>
            <div contenteditable="true" class="content">${this.data.desc}</div>
          </div>
          
          <div class="Card__inner__content__comments">
            <p class="hint">Comments</p>
            ${this.data.comments.length ? this.data.comments.map(item => `
            <div class="Card__inner__content__comments__comment">
              <section class="Card__inner__content__comments__comment__username">${item.user}</section>
              <section class="Card__inner__content__comments__comment__content">${item.content}</section>
            </div>
            `).join("") : "" }
          </div>
        </div>

        <div class="Card__inner__info">
          <div class="Card__inner__info__column">${this.data.column.title}</div>
          <div class="Card__inner__info__reporter">${this.data.reporter}</div>
          <div class="Card__inner__info__assignees">
            ${this.data.assignees.length ? this.data.assignees.map(item => `
            <div class="Card__inner__info__assignees__assignee">${item}</div>
            `).join("") : "" }
          </div>
          <div class="Card__inner__info__priority">${this.data.priority}</div>
          <div class="Card__inner__info__time">time</div>
        </div>
      </div>

    ` : "Loading your card..." }
  </div>
</template>

<script>
  import { Origin, $, debug } from "olum-helpers";
  import router from "../router/index.js";
  import icons from "../services/icons.js";
  import bugIcon from "../assets/bug.png";
  import taskIcon from "../assets/task.png";
  import lowIcon from "../assets/low.png";
  import mediumIcon from "../assets/medium.png";
  import highIcon from "../assets/high.png";
  export default class Card {
    render() {
      this.origin = new Origin();
      const { id } = router.params;
      this.getData(id);
    }

    getData(id) {
      this.origin
        .get("http://localhost:3000/cards/" + id)
        .then(this.displayCard.bind(this))
        .catch(console.error);
    }

    displayCard(data) {
      this.data = data;
      debug(data);
      // update component markup with fetched data
      this.updateTemplate();
    }

    updateTemplate() {
      const container = $(".Card");
      if (container) container.innerHTML = this.template(true);
    }
  }
</script>

<style lang="scss">
  @import "../styles/Card.scss";
</style>
